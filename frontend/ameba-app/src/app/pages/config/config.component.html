<div class="flex-center mat-padding-lg">
    <mat-card class="config-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>settings</mat-icon>
                Game Configuration
                @if (isLoading()) {
                <mat-spinner diameter="20" class="loading-spinner"></mat-spinner>
                }
            </mat-card-title>
            <mat-card-subtitle>Configure simulation parameters</mat-card-subtitle>


        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="configForm" class="config-form">

                <mat-accordion class="config-accordion">
                    <!-- Play Desk Settings -->
                    <mat-expansion-panel class="config-section" [expanded]="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <mat-icon>grid_on</mat-icon>
                                Play Desk Configuration
                            </mat-panel-title>
                            <mat-panel-description>
                                World dimensions and energy settings
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <div formGroupName="play_desk" class="section-content">
                            <div class="form-row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Total Energy</mat-label>
                                    <input matInput type="number" formControlName="total_energy" min="1000"
                                        max="100000">
                                    <mat-hint>Total energy in the world (1000-100000)</mat-hint>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>Energy per Food</mat-label>
                                    <input matInput type="number" formControlName="energy_per_food" min="10" max="200">
                                    <mat-hint>Energy value per food item (10-200)</mat-hint>
                                </mat-form-field>
                            </div>

                            <div class="form-row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Grid Rows</mat-label>
                                    <input matInput type="number" formControlName="rows" min="10" max="100">
                                    <mat-hint>Number of rows in the world grid (10-100)</mat-hint>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>Grid Columns</mat-label>
                                    <input matInput type="number" formControlName="columns" min="10" max="100">
                                    <mat-hint>Number of columns in the world grid (10-100)</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                    </mat-expansion-panel>

                    <!-- Ameba Settings -->
                    <mat-expansion-panel class="config-section">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <mat-icon>pest_control</mat-icon>
                                Ameba Configuration
                            </mat-panel-title>
                            <mat-panel-description>
                                Individual ameba behavior and energy settings
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <div formGroupName="ameba" class="section-content">
                            <div class="form-row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Lostness Weight Coefficient</mat-label>
                                    <input matInput type="number"
                                        formControlName="threhold_of_lostness_weight_coefficient" min="0" max="1"
                                        step="0.1">
                                    <mat-hint>Threshold coefficient for lostness weight (0.0-1.0)</mat-hint>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>Initial Energy</mat-label>
                                    <input matInput type="number" formControlName="initial_energy" min="50" max="500">
                                    <mat-hint>Initial energy for new amebas (50-500)</mat-hint>
                                </mat-form-field>
                            </div>

                            <div class="form-row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Visible Rows</mat-label>
                                    <input matInput type="number" formControlName="visible_rows" min="3" max="15">
                                    <mat-hint>Number of visible rows for ameba (3-15)</mat-hint>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>Visible Columns</mat-label>
                                    <input matInput type="number" formControlName="visible_columns" min="3" max="15">
                                    <mat-hint>Number of visible columns for ameba (3-15)</mat-hint>
                                </mat-form-field>
                            </div>

                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Energy Lost per Move</mat-label>
                                <input matInput type="number" formControlName="lost_energy_per_move" min="0.1" max="10"
                                    step="0.1">
                                <mat-hint>Energy lost per movement (0.1-10.0)</mat-hint>
                            </mat-form-field>
                        </div>
                    </mat-expansion-panel>

                    <!-- Neural Network Settings -->
                    <mat-expansion-panel class="config-section">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <mat-icon>psychology</mat-icon>
                                Neural Network Configuration
                            </mat-panel-title>
                            <mat-panel-description>
                                AI and neural network structure settings
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <div formGroupName="neural_network" class="section-content">
                            <div class="form-row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Hidden Layers</mat-label>
                                    <input matInput type="number" formControlName="initial_hidden_layers" min="1"
                                        max="10">
                                    <mat-hint>Number of initial hidden layers (1-10)</mat-hint>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>Neurons per Layer</mat-label>
                                    <input matInput type="number" formControlName="initial_neurons_on_layer" min="8"
                                        max="256">
                                    <mat-hint>Number of neurons per layer (8-256)</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                    </mat-expansion-panel>
                </mat-accordion>

            </form>
        </mat-card-content>

        <mat-card-actions class="config-actions">
            <!-- Primary Actions -->
            <div class="primary-actions">
                <button mat-raised-button color="primary" (click)="saveConfig()"
                    [disabled]="configForm.invalid || isLoading()">
                    <mat-icon>save</mat-icon>
                    Save Configuration
                </button>

                <button mat-stroked-button (click)="resetToDefaults()" [disabled]="isLoading()">
                    <mat-icon>refresh</mat-icon>
                    Reset to Defaults
                </button>

                <button mat-button (click)="previewConfig()" [disabled]="configForm.invalid">
                    <mat-icon>preview</mat-icon>
                    Preview Changes
                </button>
            </div>



            <div class="spacer"></div>

            <!-- Navigation Actions -->
            <div class="navigation-actions">
                <button mat-button routerLink="/game" color="accent" [disabled]="isLoading()">
                    <mat-icon>play_arrow</mat-icon>
                    Start Game
                </button>

                <button mat-button routerLink="/">
                    <mat-icon>home</mat-icon>
                    Back to Home
                </button>
            </div>
        </mat-card-actions>
    </mat-card>
</div>